{% extends 'tienda/base.html' %}
{% load static %}

{% block content %}
<h2>Subastas Activas</h2>

<div class="auction-list">
  {% for subasta in subastas %}
  <div class="auction-item">
    <img src="{{ subasta.producto.imagen.url }}" alt="{{ subasta.producto.nombre }}">
    <div class="auction-details">
      <h3>{{ subasta.producto.nombre }}</h3>
      <p>{{ subasta.producto.descripcion|default:"Sin descripci√≥n" }}</p>
      <p>Precio actual: ${{ subasta.precio_actual|default:subasta.precio_inicial }}</p>
      <p>Tiempo restante: <span class="countdown" data-end="{{ subasta.fecha_finalizacion|date:'Y-m-d H:i:s' }}"></span></p>
      <a href="{% url 'tienda:detalle_subasta' subasta.slug %}" class="btn btn-primary">Ver detalles</a>
    </div>
  </div>
  {% empty %}
  <p>No hay subastas activas en este momento.</p>
  {% endfor %}
</div>

{% block scripts %}
<script>
// Contador regresivo
document.addEventListener('DOMContentLoaded', function() {
    const countdownElements = document.querySelectorAll('.countdown');
    countdownElements.forEach(el => {
        const endDate = new Date(el.dataset.end).getTime();
        function updateCountdown() {
            const now = new Date().getTime();
            const distance = endDate - now;
            if (distance < 0) {
                el.innerHTML = "Finalizada";
                return;
            }
            const days = Math.floor(distance / (1000*60*60*24));
            const hours = Math.floor((distance % (1000*60*60*24)) / (1000*60*60));
            const minutes = Math.floor((distance % (1000*60*60)) / (1000*60));
            el.innerHTML = `${days}d ${hours}h ${minutes}m`;
        }
        updateCountdown();
        setInterval(updateCountdown, 60000);
    });
});
</script>
{% endblock %}
{% endblock %}
